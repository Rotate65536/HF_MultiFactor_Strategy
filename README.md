# README(CHI)

这是一个从利用分钟级OHLCV数据构建日频因子，到利用IC法和分位组累积收益法对因子的选股效果进行评估，再到训练基于Lasso和LSTM的收益预测模型，最后进行策略验证的一个较为完整的练习过程。

最后获得的策略收益并不突出，因此仅作为个人学习和参考。

## 介绍

![strategy](https://raw.githubusercontent.com/Rotate65536/HF_MultiFactor_Strategy/master/imgs/strategy.png)

1. 基于分钟级OHLCV数据计算因子，因子的构建方法如下：

   | **符号** | **计算说明**                                                 |
   | -------- | ------------------------------------------------------------ |
   | QUA      | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列，记为A；  2. 将A从小到大排序，剔除极端值；  3. 构造指标S=(A10% - Amin)  / (Amax - Amin)，其中Amax，Amin分别为最大和最小值，A10%为10%分位值；  4. 滚动20个交易日计算S指标的均值，即可得到QUA因子。 |
   | STD      | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列；  2. 保留10%单笔成交金额较小的样本计算标准差，记作D指标；  3. 计算D指标的20日均值，即为STD因子。 |
   | SKEW     | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列；  2. 保留50%单笔成交金额较小的样本计算偏度，记为S指标；  3. 计算S指标的20日均值，即SKEW。 |
   | KURT     | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列；  2. 保留50%单笔成交金额较小的样本计算偏度，记为K指标；  3. 计算K指标的20日均值，即KURT。 |
   | MTS      | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列和分钟成交额；  2. 计算单笔成交金额与成交额的相关系数，记为TS指标；  3. 滚动20个交易日计算TS指标的均值，即MTS因子。 |
   | MTE      | 1. 选定股票，逐个交易日回顾分钟单笔成交金额序列和分钟收盘；  2. 计算单笔成交金额与收盘价的相关系数，记为TE指标；  3. 滚动20个交易日计算TE指标的均值，即MTE因子。 |
   | SR       | 1. 回溯过去20个交易日内每分钟的涨跌幅和单笔成交金额；  2. 将全部分钟涨跌幅按照单笔成交金额由大到小排序；  3. 选取单笔成交金额前                                                                      比例的涨跌幅加总，即为SR因子。 |

2. 评估因子选股效果。

   - IC法指标评估：

     | 指标           | QUA    | STD    | SKEW   | KURT   | MTS    | MTE    | SR     |
     | -------------- | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
     | 阿尔法         | -0.123 | -0.116 | 0.162  | -0.157 | 0.023  | -0.091 | -0.111 |
     | 贝塔           | 0.115  | 0.057  | -0.112 | 0.070  | -0.063 | 0.035  | 0.040  |
     | 信息系数       | 0.080  | 0.070  | 0.082  | 0.081  | 0.006  | 0.052  | 0.057  |
     | 信息比率       | 0.577  | 0.496  | 0.617  | 0.651  | 0.050  | 0.555  | 0.667  |
     | 分位收益差     | 13.531 | 11.107 | 16.413 | 17.157 | 1.942  | 9.017  | 9.193  |
     | 因子自相关系数 | 0.945  | 0.937  | 0.931  | 0.891  | 0.846  | 0.607  | 0.527  |
     | 换手率         | 0.517  | 0.528  | 0.547  | 0.607  | 0.681  | 0.789  | 0.791  |

   - 分位组累积收益图：

     见`factor_evaluation.ipynb`。

3. 对历史因子值滚动划分训练数据，以$t-S$~$t$天的因子值作为输入，第$t+N$天的因子收益作为输出，训练机器学习模型。注意进行最大最小归一化以及PCA降维处理。其中$S$是滚动窗口大小，$N$是调仓频率。

4. 在历史区间上回测，得到回测效果。

   ![test](https://raw.githubusercontent.com/Rotate65536/HF_MultiFactor_Strategy/master/imgs/test.png)

## 使用

### 安装

- 环境:
  1. Windows 10
  2. Pytorch
  3. Scikit-Learn
  4. Alphalens（此项目用到的alphalens工具包已经集成，见`alphalens_bugfix`）

### 下载

- 下载OHLCV分钟级原始数据以及日频股票价格数据，并解压到data文件夹中，百度云/谷歌云，提取码：。
- 若希望跳过因子计算步骤，下载计算得到的日频因子数据，并解压到data文件夹中，百度云/谷歌云，提取码：。

### 因子计算

运行`python factor_calculation.py`，生成的因子值在`data/factor_mainforce`路径下。

### 因子评估

运行`factor_evaluation.ipynb`，生成的分位数累积收益图在`evaluation/cumlative_return`路径下。

### 收益预测模型训练

- 训练PCA-Lasso模型

  运行`pca_lasso.ipynb`，生成的模型存放在`models`路径下。

- 训练PCA-LSTM模型

  运行`pca_lstm.ipynb`，生成的模型存放在`models`路径下。

### 策略回测

运行`strategy_validation.ipynb`，回测记录存放在`records`路径下。
